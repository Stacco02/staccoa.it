<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Staccoa.it – Area Riservata</title>
  <style>
    :root {
      color-scheme: dark;
    }
    body { background-color: #050505; color: #fff; font-family: Arial, sans-serif; margin: 0; min-height: 100vh; }
    header { background:#0f0f0f; padding:20px 30px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,0.1); }
    header h1 { margin:0; font-size:20px; color:#ff6600; }
    header button { background:#ff6600; color:#fff; border:none; padding:10px 18px; border-radius:4px; cursor:pointer; font-weight:bold; }
    main { max-width:900px; margin:40px auto; padding:0 20px; }
    .welcome-card { background:#111; padding:30px; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.4); margin-bottom:30px; }
    .welcome-card h2 { margin:0 0 10px; font-size:28px; }
    .welcome-card p { margin:0; color:#d0d0d0; }
    .catalog { display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:20px; list-style:none; padding:0; margin:0; }
    .catalog li { background:#141414; border-radius:10px; padding:20px; border:1px solid rgba(255,255,255,0.08); transition:transform .2s, border-color .2s; }
    .catalog li:hover { transform:translateY(-4px); border-color:#ff6600; }
    .catalog a { color:#fff; text-decoration:none; font-size:18px; display:block; margin-bottom:8px; }
    .catalog span { color:#b5b5b5; font-size:14px; }
    .back-link { display:inline-block; margin-top:40px; color:#ff6600; text-decoration:none; }
  </style>
</head>
<body>
  <header>
    <h1>Dashboard Staccoa.it</h1>
    <button onclick="logout()">Esci</button>
  </header>
  <main>
    <section class="welcome-card">
      <h2 id="welcomeTitle">Benvenuto!</h2>
      <p id="userInfo">Caricamento informazioni utente...</p>
    </section>
    <section>
      <h3>Catalogo App & Link utili</h3>
      <ul class="catalog">
        <li>
          <a href="https://qrgenerator.staccoa.it" target="_blank" rel="noopener">QR Generator</a>
          <span>Crea e condividi QR personalizzati.</span>
        </li>
        <li>
          <a href="https://chat.whatsapp.com/BnbeaO4YDjFCYm7K5jZNTQ" target="_blank" rel="noopener">Community WhatsApp</a>
          <span>Resta aggiornato e parla con il team.</span>
        </li>
        <li>
          <a href="https://open.spotify.com/playlist/7EYouvXeJnCCPuw47wjE3S?si=7f6c296f2bbb4189" target="_blank" rel="noopener">Playlist Spotify</a>
          <span>La colonna sonora ufficiale di Staccoa.it.</span>
        </li>
      </ul>
    </section>
    <a class="back-link" href="index.html">← Torna alla pagina pubblica</a>
  </main>
  <script>
    async function fetchSession() {
      try {
        const response = await fetch('/api/session', { credentials: 'include' });
        const data = await response.json();
        if (!data.authenticated) {
          window.location.href = 'login.html';
          return;
        }
        const userInfo = document.getElementById('userInfo');
        const welcome = document.getElementById('welcomeTitle');
        if (data.user && data.user.nome) {
          welcome.textContent = `Benvenuto, ${data.user.nome}!`;
          userInfo.textContent = 'Seleziona una delle app disponibili qui sotto.';
        } else {
          userInfo.textContent = 'Accesso verificato.';
        }
      } catch (error) {
        console.error('Errore sessione', error);
        window.location.href = 'login.html';
      }
    }

    async function logout() {
      try {
        await fetch('/api/logout', { method: 'POST', credentials: 'include' });
      } finally {
        window.location.href = 'login.html';
      }
    }

    document.addEventListener('DOMContentLoaded', fetchSession);
  </script>
</body>
</html>
